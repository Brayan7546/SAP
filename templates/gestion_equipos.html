{% extends 'base.html' %}

{%block custom %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/gestion_equipos.css') }}">
{%endblock%}

{% block body %}
<div class="container mt-4" style="margin: 1rem; max-width: 98%;">
    <div class="row">

        <!-- Contenedor de la lista de equipos -->
        <div class="col-md-4">
            <div id="navigation-info">
                <button class="volverBtn" onclick="">
                    <i class="bi bi-chevron-left"></i>
                </button>
                <p>PLANTILLA DE CARGA DE EQUIPOS</p>
            </div>

            <div class="list-group">
                <input type="text" class="form-control mb-2" placeholder="Buscar equipo" id="buscar-equipo">
                <button class="list-group-item list-group-item-action active" onclick="mostrarFormularioNuevo()">
                    Añadir equipo
                </button>
                {% for equipo in equipos %}
                <button class="list-group-item list-group-item-action" onclick="cargarEquipo('{{ equipo.id }}')">
                    {{ equipo.invnr }} - {{ equipo.shtxt }}
                </button>
                {% endfor %}
            </div>
        </div>
        
        <!-- Contenedor principal -->
        <div class="col-md-8">
            <!-- Botón para alternar vistas -->
            <div class="text-end mb-3">
                <button class="btn btn-secondary" id="toggle-view-btn" onclick="toggleVista()">Mostrar Listado</button>
            </div>

            <!-- Contenedor de detalles del equipo -->
            <div id="detalle-equipo" class="card">
                <div class="card-body">

                    <!-- Botones de navegación -->
                    <div class="buttons mb-3">
                        <button class="tab-button btn active" data-target="section1">Datos Básicos</button>
                        <button class="tab-button btn" data-target="section2">Características</button>
                    </div>

                    <!-- Contenido de las secciones -->
                    <div class="content">
                        <!-- Sección de Datos Básicos -->
                        <div id="section1" class="zone section active">
                            <p id="detalle-titulo"></p>
                            <form id="form-equipo-basico">
                                <div class="row">
                                    <div class="col-md-6 mb-3 form-floating">
                                        <input type="text" id="eqtyp" name="eqtyp" class="form-control" maxlength="1" placeholder="Tipo de equipo" required>
                                        <label for="eqtyp">Tipo de equipo</label>
                                    </div>
                                    <div class="col-md-6 mb-3 form-floating">
                                        <input type="text" id="shtxt" name="shtxt" class="form-control" maxlength="40" placeholder="Denominación" required>
                                        <label for="shtxt">Denominación</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3 form-floating">
                                        <input type="number" step="0.001" id="brgew" name="brgew" class="form-control" placeholder="Peso del objeto">
                                        <label for="brgew">Peso del objeto</label>
                                    </div>
                                    <div class="col-md-6 mb-3 form-floating">
                                        <input type="text" id="gewei" name="gewei" class="form-control" maxlength="3" placeholder="Unidad de peso">
                                        <label for="gewei">Unidad de peso</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3 form-floating">
                                        <input type="text" id="groes" name="groes" class="form-control" maxlength="18" placeholder="Tamaño/Dimensión">
                                        <label for="groes">Tamaño/Dimensión</label>
                                    </div>
                                    <div class="col-md-6 mb-3 form-floating">
                                        <input type="text" id="invnr" name="invnr" class="form-control" maxlength="25" placeholder="Número de inventario">
                                        <label for="invnr">Número de inventario</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3 form-floating">
                                        <input type="date" id="inbdt" name="inbdt" class="form-control" placeholder="Fecha de puesta en servicio">
                                        <label for="inbdt">Fecha de puesta en servicio</label>
                                    </div>
                                    <div class="col-md-6 mb-3 form-floating">
                                        <input type="text" id="eqart" name="eqart" class="form-control" maxlength="10" placeholder="Clase de objeto / Tipo">
                                        <label for="eqart">Clase de objeto / Tipo</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3 form-floating">
                                        <input type="number" step="0.01" id="answt" name="answt" class="form-control" placeholder="Valor de adquisición">
                                        <label for="answt">Valor de adquisición</label>
                                    </div>
                                    <div class="col-md-6 mb-3 form-floating">
                                        <input type="date" id="ansdt" name="ansdt" class="form-control" placeholder="Fecha de adquisición">
                                        <label for="ansdt">Fecha de adquisición</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3 form-floating">
                                        <input type="text" id="waers" name="waers" class="form-control" maxlength="5" placeholder="Clave de moneda">
                                        <label for="waers">Clave de moneda</label>
                                    </div>
                                    <div class="col-md-6 mb-3 form-floating">
                                        <input type="text" id="herst" name="herst" class="form-control" maxlength="30" placeholder="Fabricante">
                                        <label for="herst">Fabricante</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3 form-floating">
                                        <input type="text" id="herld" name="herld" class="form-control" maxlength="3" placeholder="País de fabricación">
                                        <label for="herld">País de fabricación</label>
                                    </div>
                                    <div class="col-md-6 mb-3 form-floating">
                                        <input type="text" id="typbz" name="typbz" class="form-control" maxlength="20" placeholder="Denominación del tipo">
                                        <label for="typbz">Denominación del tipo</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3 form-floating">
                                        <input type="text" id="baujj" name="baujj" class="form-control" maxlength="4" placeholder="Año de construcción">
                                        <label for="baujj">Año de construcción</label>
                                    </div>
                                    <div class="col-md-6 mb-3 form-floating">
                                        <input type="text" id="baumm" name="baumm" class="form-control" maxlength="2" placeholder="Mes de construcción">
                                        <label for="baumm">Mes de construcción</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3 form-floating">
                                        <select id="class" name="class" class="form-select" placeholder="Seleccione una clase">
                                            <option value="" disabled selected>Seleccione una clase</option>
                                        </select>
                                        <label for="class">N° de clase</label>
                                    </div>
                                </div>
                            </form>                            
                        </div>

                        <!-- Sección de Características -->
                        <div id="section2" class="zone section">
                            <form id="form-equipo-caracteristicas">
                                <div class="row">
                                    <!-- Contenedor para los campos dinámicos -->
                                    <div id="campos-dinamicos" class="row">
                                        <!-- Mensaje predeterminado -->
                                        <div id="mensaje-campos-dinamicos" class="text-center text-muted w-100">
                                            Por favor, seleccione el N° de clase.
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabla de equipos -->
            <div id="tabla-equipos" class="card d-none">
                <div class="card-body" style="max-height: 300px; overflow-y:auto;">
                    <h5 class="card-title">Listado de Equipos</h5>
                    <table class="table table-bordered table-striped mt-3">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Tipo Equipo (eqtyp)</th>
                                <th>Denominación (shtxt)</th>
                                <th>Peso (brgew)</th>
                                <th>Unidad Peso (gewei)</th>
                                <th>Tamaño (groes)</th>
                                <th>Número Inventario (invnr)</th>
                                <th>F. puesta servicio (inbdt)</th>
                                <th>Clase Objeto (eqart)</th>
                                <th>Valor Adquisición (answt)</th>
                                <th>F. Adquisición (ansdt)</th>
                                <th>Moneda (waers)</th>
                                <th>Fabricante (herst)</th>
                                <th>País (herld)</th>
                                <th>Denominación tipo (typbz)</th>
                                <th>Año construcción (baujj)</th>
                                <th>Mes construcción (baumm)</th>
                                <th>Características (caracteristicas)</th>
                                <th>Clase (class)</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for equipo in equipos %}
                            <tr>
                                <td>{{ equipo.id }}</td>
                                <td>{{ equipo.eqtyp }}</td>
                                <td>{{ equipo.shtxt }}</td>
                                <td>{{ equipo.brgew }}</td>
                                <td>{{ equipo.gewei }}</td>
                                <td>{{ equipo.groes }}</td>
                                <td>{{ equipo.invnr }}</td>
                                <td>{{ equipo.inbdt }}</td>
                                <td>{{ equipo.eqart }}</td>
                                <td>{{ equipo.answt }}</td>
                                <td>{{ equipo.ansdt }}</td>
                                <td>{{ equipo.waers }}</td>
                                <td>{{ equipo.herst }}</td>
                                <td>{{ equipo.herld }}</td>
                                <td>{{ equipo.typbz }}</td>
                                <td>{{ equipo.baujj }}</td>
                                <td>{{ equipo.baumm }}</td>
                                <td>{{ equipo.caracteristicas }}</td>
                                <td>{{ equipo.class }}</td>
                                <td>
                                    <button class="btn btn-warning btn-sm" onclick="cargarEquipo({{ equipo.id }})">Editar</button>
                                    <button class="btn btn-danger btn-sm" onclick="eliminarEquipo({{ equipo.id }})">Eliminar</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>  
                </div>
            </div>

            <!-- Botón para guardar los datos -->
            <div class="mt-3 text-end">
                <button type="button" class="btn btn-primary" onclick="guardarEquipo()">Guardar</button>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/gestion_equipos.js') }}"></script>
<script>
    function toggleVista() {
        const detalleEquipo = document.getElementById('detalle-equipo');
        const tablaEquipos = document.getElementById('tabla-equipos');
        const toggleButton = document.getElementById('toggle-view-btn');
    
        if (tablaEquipos.classList.contains('d-none')) {
            tablaEquipos.classList.remove('d-none');
            detalleEquipo.classList.add('d-none');
            toggleButton.textContent = "Mostrar Formulario";
        } else {
            tablaEquipos.classList.add('d-none');
            detalleEquipo.classList.remove('d-none');
            toggleButton.textContent = "Mostrar Listado";
        }
    }
</script>
{% endblock %}
